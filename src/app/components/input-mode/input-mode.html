<div class="input-mode">
  <h2>Input Mode</h2>

  @if (gameState.currentPlayer(); as player) {
    <div class="current-player-info">
      <span class="player-name">{{ player.name }}</span>
      <span class="remaining-score"><strong>{{ player.currentScore }}</strong> left</span>
      <span class="round-info">Round {{ gameState.activeRound().throws.length }}/3: <strong>{{ gameState.activeRound().totalScore }}</strong> pts</span>
    </div>

    @if (errorMessage()) {
      <div class="error-message">{{ errorMessage() }}</div>
    }

    <!-- Dart Number Buttons - Sequential order -->
    <div class="dart-grid">
      <!-- Row 0: Throws + 0 + Bull -->
      @for (dartThrow of gameState.activeRound().throws; track $index) {
        <div class="throw-chip">
          <span class="throw-value">
            @if (dartThrow.multiplier === 1) {
              {{ dartThrow.value }}
            } @else if (dartThrow.multiplier === 2) {
              D{{ dartThrow.value }}
            } @else {
              T{{ dartThrow.value }}
            }
          </span>
          <span class="throw-points">{{ dartThrow.score }}</span>
        </div>
      }

      @for (empty of [0, 1, 2]; track $index) {
        @if ($index >= gameState.activeRound().throws.length) {
          <div class="throw-chip empty">
            <span class="throw-value">-</span>
          </div>
        }
      }

      <button class="dart-btn-compound miss-btn" (click)="addDartThrow(0, 1)">
        <span class="number-main">0</span>
      </button>

      <button class="dart-btn-compound bull-compound">
        <span class="bull-single" (click)="addDartThrow(25, 1)">25</span>
        <span class="bull-double" (click)="addDartThrow(25, 2)">D25</span>
      </button>

      <!-- Row 1: 1-5 -->
      @for (value of [1, 2, 3, 4, 5]; track value) {
        <button class="dart-btn-compound">
          <span class="multiplier-left double-zone" (click)="addDartThrow(value, 2)">2×</span>
          <span class="number-main single-zone" (click)="addDartThrow(value, 1)">{{ value }}</span>
          <span class="multiplier-right triple-zone" (click)="addDartThrow(value, 3)">3×</span>
        </button>
      }

      <!-- Row 2: 6-10 -->
      @for (value of [6, 7, 8, 9, 10]; track value) {
        <button class="dart-btn-compound">
          <span class="multiplier-left double-zone" (click)="addDartThrow(value, 2)">2×</span>
          <span class="number-main single-zone" (click)="addDartThrow(value, 1)">{{ value }}</span>
          <span class="multiplier-right triple-zone" (click)="addDartThrow(value, 3)">3×</span>
        </button>
      }

      <!-- Row 3: 11-15 -->
      @for (value of [11, 12, 13, 14, 15]; track value) {
        <button class="dart-btn-compound">
          <span class="multiplier-left double-zone" (click)="addDartThrow(value, 2)">2×</span>
          <span class="number-main single-zone" (click)="addDartThrow(value, 1)">{{ value }}</span>
          <span class="multiplier-right triple-zone" (click)="addDartThrow(value, 3)">3×</span>
        </button>
      }

      <!-- Row 4: 16-20 -->
      @for (value of [16, 17, 18, 19, 20]; track value) {
        <button class="dart-btn-compound">
          <span class="multiplier-left double-zone" (click)="addDartThrow(value, 2)">2×</span>
          <span class="number-main single-zone" (click)="addDartThrow(value, 1)">{{ value }}</span>
          <span class="multiplier-right triple-zone" (click)="addDartThrow(value, 3)">3×</span>
        </button>
      }
    </div>

    <!-- Action Buttons -->
    <div class="round-actions">
      <button class="undo-btn" (click)="undoLastThrow()" [disabled]="gameState.activeRound().throws.length === 0">
        ↶ Undo
      </button>
      <button class="clear-btn" (click)="clearRound()">Clear</button>
      <button class="submit-btn" (click)="submitRound()">
        Submit Round
      </button>
    </div>
  }
</div>
